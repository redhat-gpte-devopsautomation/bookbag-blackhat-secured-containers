:guid: %guid%,
:bastion_public_hostname: %bastion_public_hostname%,
:bastion_ssh_password: %bastion_ssh_password%,
:bastion_ssh_user_name: %bastion_ssh_user_name%,

=== Relocate Application To Primary

[arabic]
In this section of the workshop, we will introduce Tekton Chains, which enables image signing in our pipelines i.e. any image built in our pipeline will be signed using a private key.  A public key will be used to verify signatures.  Tekton has a few options available to sign your images:

* x509
* Cosign
* KMS
* EXPERIMENTAL: Keyless signing

In this workshop, we will be using Cosign.
To get started signing things in Chains, you must generate a keypair and instruct Chains to sign with it via an Openshift secret. Chains expect a private key and password, if the key is encrypted, to exist in a Kubernetes secret signing-secrets in the openshift-pipelines namespace.

. Login into your bastion server by executing the below command:
+
[source,role="execute"]
----
ssh -o StrictHostKeyChecking=no %bastion_user%@%bastion_server%
----
+
. You are again going to make an update to the price of the Quarkus T-shirt.  Update the price by running the below commands:
+
[source, bash]
----
POD=$(oc get pods -n globex | grep catalog-database | awk '{print $1}')
oc exec -it pod/$POD -n globex -- psql --dbname catalog --command "update catalog set price = 20 where name = 'Quarkus T-shirt';"
----
+
. Confirm if the price has updated to by switching back to the Globex application on the secondary cluster and refresh the page.  Select the last page (6) and notice that the price of the Quarkust T-shirt is now *$20.00*
+
image:images/secondary-price-updated.png[images/secondary-price-updated.png]
+
. Go back to the RHACM console and select *Applications* and filter on *Subscription*.  Click the 3 dots at the end of the *globex* application and select *Relocate application*.
+
image:images/rhacm-relocate-menu.png[images/rhacm-relocate-menu.png]
+
. Provide the following details on the popup:
.. *Select policy*: drsync5m
.. *Target cluster*: primary
.. *Select subscriptions group*: globex-subscription-1
+
image:images/rhacm-relocate-application.png[images/rhacm-relocate-application.png]
+
NOTE: The subscription group may not be in a ready state to select.  Wait a few minutes and try again.
.. Click *Initiate*
. You will notice that the pods on the secondary cluster in the *globex* namespace will start terminating as the app starts relocating back to the primary cluster.
+
image:images/secondary-pods-terminated.png[images/secondary-pods-terminated.png]
+
. Switch to the *primary* cluster console and click *Workloads->Pods* on the left menu.  Ensure your selected project is *globex*.  Notice that the application pods have been recreated in this namespace.
+
image:images/primary-pods-created.png[images/primary-pods-created.png]
+
. Next, click *Networking->Routes* on the left menu and then click on the *Location* link of the *globex-ui* route.
+
image:images/primary-globex-route.png[images/primary-globex-route.png]
+
. Once you've clicked the link you will be redirected to globex online store front end.  Select *Cool Stuff Store* at the top of the page.
+
image:images/primary-globex-landing.png[images/primary-globex-landing.png]
+
. Select the last page (6) and notice that the price of the Quarkust T-shirt is still *$20.00*.
+
image:images/secondary-price-updated.png[images/secondary-price-updated.png]
